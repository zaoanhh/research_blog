<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="è¿™ä¸ªæ¶æ„åˆ©ç”¨ PyTorch Lightning å¤„ç†è®­ç»ƒå¾ªç¯ï¼Œåˆ©ç”¨ Hydra å¤„ç†å¤æ‚çš„å‚æ•°é…ç½®å’Œå®éªŒç®¡ç†ã€‚\nå‰ç½®å‡†å¤‡ å®‰è£…å¿…è¦çš„åº“ï¼š\nBash\n1 pip install pytorch-lightning hydra-core tensorboard é¡¹ç›®ç›®å½•ç»“æ„ Hydra ä¸¥æ ¼ä¾èµ–æ–‡ä»¶ç»“æ„ï¼Œè¯·ç¡®ä¿ä½ çš„é¡¹ç›®ç¬¦åˆä»¥ä¸‹å±‚çº§ï¼š\n"><title>PyTorch Lightning + Hydra å·¥ç¨‹åŒ–å®è·µ</title><link rel=canonical href=https://zaoanhh.github.io/research_blog/p/pytorch-lightning--hydra-%E5%B7%A5%E7%A8%8B%E5%8C%96%E5%AE%9E%E8%B7%B5/><link rel=stylesheet href=/research_blog/scss/style.min.b0e76e98cdd4f7082d1fc36f7af7e0843a81201db2197c03ca426751dc923735.css><meta property='og:title' content="PyTorch Lightning + Hydra å·¥ç¨‹åŒ–å®è·µ"><meta property='og:description' content="è¿™ä¸ªæ¶æ„åˆ©ç”¨ PyTorch Lightning å¤„ç†è®­ç»ƒå¾ªç¯ï¼Œåˆ©ç”¨ Hydra å¤„ç†å¤æ‚çš„å‚æ•°é…ç½®å’Œå®éªŒç®¡ç†ã€‚\nå‰ç½®å‡†å¤‡ å®‰è£…å¿…è¦çš„åº“ï¼š\nBash\n1 pip install pytorch-lightning hydra-core tensorboard é¡¹ç›®ç›®å½•ç»“æ„ Hydra ä¸¥æ ¼ä¾èµ–æ–‡ä»¶ç»“æ„ï¼Œè¯·ç¡®ä¿ä½ çš„é¡¹ç›®ç¬¦åˆä»¥ä¸‹å±‚çº§ï¼š\n"><meta property='og:url' content='https://zaoanhh.github.io/research_blog/p/pytorch-lightning--hydra-%E5%B7%A5%E7%A8%8B%E5%8C%96%E5%AE%9E%E8%B7%B5/'><meta property='og:site_name' content="Fei's Research Blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='pytorch'><meta property='article:tag' content='hydra'><meta property='article:tag' content='lightning'><meta property='article:published_time' content='2025-11-23T21:43:40+08:00'><meta property='article:modified_time' content='2025-11-23T21:43:40+08:00'><meta name=twitter:title content="PyTorch Lightning + Hydra å·¥ç¨‹åŒ–å®è·µ"><meta name=twitter:description content="è¿™ä¸ªæ¶æ„åˆ©ç”¨ PyTorch Lightning å¤„ç†è®­ç»ƒå¾ªç¯ï¼Œåˆ©ç”¨ Hydra å¤„ç†å¤æ‚çš„å‚æ•°é…ç½®å’Œå®éªŒç®¡ç†ã€‚\nå‰ç½®å‡†å¤‡ å®‰è£…å¿…è¦çš„åº“ï¼š\nBash\n1 pip install pytorch-lightning hydra-core tensorboard é¡¹ç›®ç›®å½•ç»“æ„ Hydra ä¸¥æ ¼ä¾èµ–æ–‡ä»¶ç»“æ„ï¼Œè¯·ç¡®ä¿ä½ çš„é¡¹ç›®ç¬¦åˆä»¥ä¸‹å±‚çº§ï¼š\n"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/research_blog/><img src=/research_blog/img/logo_hu_377e742e99412c9.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/research_blog>Fei's Research Blog</a></h1><h2 class=site-description>å›å­é£Ÿæ— æ±‚é¥±ï¼Œå±…æ— æ±‚å®‰ï¼Œæ•äºäº‹è€Œä¸è®·äºè¨€ï¼Œå°±æœ‰é“è€Œæ­£ç„‰</h2></div></header><ol class=menu-social><li><a href=mailto:feishang@hku.hk target=_blank title=Email rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-mail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg></a></li><li><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/research_blog/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/research_blog/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/research_blog/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/research_blog/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#å‰ç½®å‡†å¤‡>å‰ç½®å‡†å¤‡</a></li><li><a href=#é¡¹ç›®ç›®å½•ç»“æ„>é¡¹ç›®ç›®å½•ç»“æ„</a></li><li><a href=#é…ç½®æ–‡ä»¶ç¼–å†™-yaml>é…ç½®æ–‡ä»¶ç¼–å†™ (YAML)</a><ol><li><a href=#confmodeldefault_modelyaml><code>conf/model/default_model.yaml</code></a></li><li><a href=#conftraindefault_trainyaml><code>conf/train/default_train.yaml</code></a></li><li><a href=#confconfigyaml><code>conf/config.yaml</code></a></li></ol></li><li><a href=#æ¨¡å‹ä»£ç -python>æ¨¡å‹ä»£ç  (Python)</a><ol><li><a href=#srcmodelpy><code>src/model.py</code></a></li></ol></li><li><a href=#ä¸»ç¨‹åº-python>ä¸»ç¨‹åº (Python)</a><ol><li><a href=#mainpy><code>main.py</code></a></li></ol></li><li><a href=#å¦‚ä½•è¿è¡Œå®éªŒ>å¦‚ä½•è¿è¡Œå®éªŒ</a><ol><li><a href=#åŸºç¡€è¿è¡Œ>åŸºç¡€è¿è¡Œ</a></li><li><a href=#åŠ¨æ€ä¿®æ”¹å‚æ•°-override>åŠ¨æ€ä¿®æ”¹å‚æ•° (Override)</a></li><li><a href=#å¤šé‡è¿è¡Œ-multirun--grid-search>å¤šé‡è¿è¡Œ (Multirun / Grid Search)</a></li><li><a href=#è¿›é˜¶æŠ€å·§ä½¿ç”¨-instantiate-æ›´ä¼˜é›…çš„å†™æ³•>è¿›é˜¶æŠ€å·§ï¼šä½¿ç”¨ <code>instantiate</code> (æ›´ä¼˜é›…çš„å†™æ³•)</a></li></ol></li><li><a href=#æŸ¥çœ‹ç»“æœ>æŸ¥çœ‹ç»“æœ</a></li><li><a href=#ä¿®æ”¹logä½ç½®>ä¿®æ”¹logä½ç½®</a><ol><li><a href=#1-ä¿®æ”¹è¾“å‡ºæ–‡ä»¶å¤¹è·¯å¾„-hydra-é…ç½®>1. ä¿®æ”¹è¾“å‡ºæ–‡ä»¶å¤¹è·¯å¾„ (Hydra é…ç½®)</a></li><li><a href=#2-ä¿®æ”¹æ—¥å¿—æ–‡ä»¶å¤¹åç§°-logger-é…ç½®>2. ä¿®æ”¹æ—¥å¿—æ–‡ä»¶å¤¹åç§° (Logger é…ç½®)</a></li><li><a href=#3-ä¿®æ”¹æ¨¡å‹æƒé‡æ–‡ä»¶å-checkpoint-å›è°ƒ>3. ä¿®æ”¹æ¨¡å‹æƒé‡æ–‡ä»¶å (Checkpoint å›è°ƒ)</a></li><li><a href=#4-å®Œæ•´æ•´åˆç¤ºä¾‹>4. å®Œæ•´æ•´åˆç¤ºä¾‹</a></li><li><a href=#confconfigyaml-1><code>conf/config.yaml</code></a></li><li><a href=#mainpy-1><code>main.py</code></a></li><li><a href=#æœ€ç»ˆæ•ˆæœ>æœ€ç»ˆæ•ˆæœ</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/research_blog/categories/code/>Code</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/research_blog/p/pytorch-lightning--hydra-%E5%B7%A5%E7%A8%8B%E5%8C%96%E5%AE%9E%E8%B7%B5/>PyTorch Lightning + Hydra å·¥ç¨‹åŒ–å®è·µ</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2025-11-23T21:43:40+08:00>Nov 23, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><p>è¿™ä¸ªæ¶æ„åˆ©ç”¨ <strong>PyTorch Lightning</strong> å¤„ç†è®­ç»ƒå¾ªç¯ï¼Œåˆ©ç”¨ <strong>Hydra</strong> å¤„ç†å¤æ‚çš„å‚æ•°é…ç½®å’Œå®éªŒç®¡ç†ã€‚</p><h2 id=å‰ç½®å‡†å¤‡>å‰ç½®å‡†å¤‡</h2><p>å®‰è£…å¿…è¦çš„åº“ï¼š</p><p>Bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pip install pytorch-lightning hydra-core tensorboard
</span></span></code></pre></td></tr></table></div></div><h2 id=é¡¹ç›®ç›®å½•ç»“æ„>é¡¹ç›®ç›®å½•ç»“æ„</h2><p>Hydra ä¸¥æ ¼ä¾èµ–æ–‡ä»¶ç»“æ„ï¼Œè¯·ç¡®ä¿ä½ çš„é¡¹ç›®ç¬¦åˆä»¥ä¸‹å±‚çº§ï¼š</p><p>Plaintext</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=nx>my_project</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=err>â”œâ”€â”€</span> <span class=nx>conf</span><span class=o>/</span>                   <span class=err>#</span> <span class=p>[</span><span class=nx>é…ç½®æ–‡ä»¶å¤¹</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>   <span class=err>â”œâ”€â”€</span> <span class=nx>config</span><span class=p>.</span><span class=nx>yaml</span>         <span class=err>#</span> <span class=nx>ä¸»å…¥å£é…ç½®</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>   <span class=err>â”œâ”€â”€</span> <span class=nx>model</span><span class=o>/</span>              <span class=err>#</span> <span class=nx>æ¨¡å‹å‚æ•°ç»„</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>   <span class=err>â”‚</span>   <span class=err>â””â”€â”€</span> <span class=nx>default_model</span><span class=p>.</span><span class=nx>yaml</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>   <span class=err>â””â”€â”€</span> <span class=nx>train</span><span class=o>/</span>              <span class=err>#</span> <span class=nx>è®­ç»ƒå‚æ•°ç»„</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>       <span class=err>â””â”€â”€</span> <span class=nx>default_train</span><span class=p>.</span><span class=nx>yaml</span>
</span></span><span class=line><span class=cl><span class=err>â”œâ”€â”€</span> <span class=nx>src</span><span class=o>/</span>                    <span class=err>#</span> <span class=p>[</span><span class=nx>æºç æ–‡ä»¶å¤¹</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>   <span class=err>â”œâ”€â”€</span> <span class=nx>__init__</span><span class=p>.</span><span class=nx>py</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>   <span class=err>â””â”€â”€</span> <span class=nx>model</span><span class=p>.</span><span class=nx>py</span>            <span class=err>#</span> <span class=nx>LightningModule</span> <span class=nx>å®šä¹‰</span>
</span></span><span class=line><span class=cl><span class=err>â””â”€â”€</span> <span class=nx>main</span><span class=p>.</span><span class=nx>py</span>                 <span class=err>#</span> <span class=p>[</span><span class=nx>ä¸»å…¥å£</span><span class=p>]</span> <span class=nx>è¿æ¥</span> <span class=nx>Hydra</span> <span class=nx>å’Œ</span> <span class=nx>Lightning</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=é…ç½®æ–‡ä»¶ç¼–å†™-yaml>é…ç½®æ–‡ä»¶ç¼–å†™ (YAML)</h2><h3 id=confmodeldefault_modelyaml><code>conf/model/default_model.yaml</code></h3><p>å®šä¹‰æ¨¡å‹çš„è¶…å‚æ•°ã€‚</p><p>YAML</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># æ¨¡å‹ç›¸å…³å‚æ•°</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>input_dim</span><span class=p>:</span><span class=w> </span><span class=m>28</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>hidden_dim</span><span class=p>:</span><span class=w> </span><span class=m>64</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>learning_rate</span><span class=p>:</span><span class=w> </span><span class=m>0.01</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=conftraindefault_trainyaml><code>conf/train/default_train.yaml</code></h3><p>å®šä¹‰ Trainer çš„å‚æ•°ã€‚</p><p>YAML</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># è®­ç»ƒå™¨ç›¸å…³å‚æ•°</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>max_epochs</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>accelerator</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;auto&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>devices</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>batch_size</span><span class=p>:</span><span class=w> </span><span class=m>32</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=confconfigyaml><code>conf/config.yaml</code></h3><p>ä¸»é…ç½®æ–‡ä»¶ï¼Œç”¨äºç»„åˆå„ä¸ªæ¨¡å—ã€‚</p><p>YAML</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>defaults</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>model</span><span class=p>:</span><span class=w> </span><span class=l>default_model   </span><span class=w> </span><span class=c># é»˜è®¤ä½¿ç”¨ conf/model/default_model.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>train</span><span class=p>:</span><span class=w> </span><span class=l>default_train   </span><span class=w> </span><span class=c># é»˜è®¤ä½¿ç”¨ conf/train/default_train.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>_self_                 </span><span class=w> </span><span class=c># å›ºå®šå†™æ³•ï¼Œè¡¨ç¤ºè¦†ç›–é¡ºåº</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># å…¨å±€é€šç”¨é…ç½®</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>seed</span><span class=p>:</span><span class=w> </span><span class=m>42</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;hydra_lightning_demo&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><hr><h2 id=æ¨¡å‹ä»£ç -python>æ¨¡å‹ä»£ç  (Python)</h2><h3 id=srcmodelpy><code>src/model.py</code></h3><p>ä¿æŒæ¨¡å‹ä»£ç çº¯å‡€ï¼Œåªåœ¨ <code>__init__</code> æ¥æ”¶å‚æ•°ã€‚</p><p>Python</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pytorch_lightning</span> <span class=k>as</span> <span class=nn>pl</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch.nn</span> <span class=k>as</span> <span class=nn>nn</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch.nn.functional</span> <span class=k>as</span> <span class=nn>F</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>LitModel</span><span class=p>(</span><span class=n>pl</span><span class=o>.</span><span class=n>LightningModule</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>input_dim</span><span class=p>,</span> <span class=n>hidden_dim</span><span class=p>,</span> <span class=n>learning_rate</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1># å…³é”®ï¼šä¿å­˜è¶…å‚æ•°ï¼Œè¿™ä¼šå°†å‚æ•°å†™å…¥ hparams.yaml å¹¶è®°å½•åˆ°æ—¥å¿—ä¸­</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>save_hyperparameters</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>layer1</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Linear</span><span class=p>(</span><span class=n>input_dim</span> <span class=o>*</span> <span class=n>input_dim</span><span class=p>,</span> <span class=n>hidden_dim</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>layer2</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Linear</span><span class=p>(</span><span class=n>hidden_dim</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=n>x</span><span class=o>.</span><span class=n>view</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>size</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>layer2</span><span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>relu</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>layer1</span><span class=p>(</span><span class=n>x</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>training_step</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>batch</span><span class=p>,</span> <span class=n>batch_idx</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=n>batch</span>
</span></span><span class=line><span class=cl>        <span class=n>logits</span> <span class=o>=</span> <span class=bp>self</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>loss</span> <span class=o>=</span> <span class=n>F</span><span class=o>.</span><span class=n>cross_entropy</span><span class=p>(</span><span class=n>logits</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># è®°å½•æ—¥å¿—</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s2>&#34;train_loss&#34;</span><span class=p>,</span> <span class=n>loss</span><span class=p>,</span> <span class=n>prog_bar</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>loss</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>configure_optimizers</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># ä½¿ç”¨ self.hparams è®¿é—®ä¿å­˜çš„å‚æ•°</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>torch</span><span class=o>.</span><span class=n>optim</span><span class=o>.</span><span class=n>Adam</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>parameters</span><span class=p>(),</span> <span class=n>lr</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>hparams</span><span class=o>.</span><span class=n>learning_rate</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=ä¸»ç¨‹åº-python>ä¸»ç¨‹åº (Python)</h2><h3 id=mainpy><code>main.py</code></h3><p>è¿™æ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ§åˆ¶ä¸­å¿ƒã€‚</p><p>Python</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hydra</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>omegaconf</span> <span class=kn>import</span> <span class=n>DictConfig</span><span class=p>,</span> <span class=n>OmegaConf</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pytorch_lightning</span> <span class=k>as</span> <span class=nn>pl</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pytorch_lightning.loggers</span> <span class=kn>import</span> <span class=n>TensorBoardLogger</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>torch.utils.data</span> <span class=kn>import</span> <span class=n>DataLoader</span><span class=p>,</span> <span class=n>TensorDataset</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>src.model</span> <span class=kn>import</span> <span class=n>LitModel</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 1. è®¾ç½® Hydra è£…é¥°å™¨ï¼ŒæŒ‡å‘ conf ç›®å½•</span>
</span></span><span class=line><span class=cl><span class=nd>@hydra.main</span><span class=p>(</span><span class=n>version_base</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>config_path</span><span class=o>=</span><span class=s2>&#34;conf&#34;</span><span class=p>,</span> <span class=n>config_name</span><span class=o>=</span><span class=s2>&#34;config&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>(</span><span class=n>cfg</span><span class=p>:</span> <span class=n>DictConfig</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;--- Current Configuration ---</span><span class=se>\n</span><span class=si>{</span><span class=n>OmegaConf</span><span class=o>.</span><span class=n>to_yaml</span><span class=p>(</span><span class=n>cfg</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># è®¾ç½®éšæœºç§å­</span>
</span></span><span class=line><span class=cl>    <span class=n>pl</span><span class=o>.</span><span class=n>seed_everything</span><span class=p>(</span><span class=n>cfg</span><span class=o>.</span><span class=n>seed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 2. å®ä¾‹åŒ–æ¨¡å‹</span>
</span></span><span class=line><span class=cl>    <span class=c1># ä» cfg.model ä¸­è¯»å–å‚æ•°</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span> <span class=o>=</span> <span class=n>LitModel</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>input_dim</span><span class=o>=</span><span class=n>cfg</span><span class=o>.</span><span class=n>model</span><span class=o>.</span><span class=n>input_dim</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>hidden_dim</span><span class=o>=</span><span class=n>cfg</span><span class=o>.</span><span class=n>model</span><span class=o>.</span><span class=n>hidden_dim</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>learning_rate</span><span class=o>=</span><span class=n>cfg</span><span class=o>.</span><span class=n>model</span><span class=o>.</span><span class=n>learning_rate</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># æ¨¡æ‹Ÿæ•°æ® (é€šå¸¸è¿™é‡Œä¼šä½¿ç”¨ LightningDataModule)</span>
</span></span><span class=line><span class=cl>    <span class=n>fake_data</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>28</span><span class=p>,</span> <span class=mi>28</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>fake_labels</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=p>(</span><span class=mi>100</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>    <span class=n>train_loader</span> <span class=o>=</span> <span class=n>DataLoader</span><span class=p>(</span><span class=n>TensorDataset</span><span class=p>(</span><span class=n>fake_data</span><span class=p>,</span> <span class=n>fake_labels</span><span class=p>),</span> <span class=n>batch_size</span><span class=o>=</span><span class=n>cfg</span><span class=o>.</span><span class=n>train</span><span class=o>.</span><span class=n>batch_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 3. é…ç½® Logger</span>
</span></span><span class=line><span class=cl>    <span class=c1># Hydra ä¼šè‡ªåŠ¨åˆ‡æ¢å·¥ä½œç›®å½•åˆ° outputs/æ—¥æœŸ/æ—¶é—´ï¼Œ</span>
</span></span><span class=line><span class=cl>    <span class=c1># æ‰€ä»¥ save_dir è®¾ç½®ä¸º &#34;.&#34; è¡¨ç¤ºå½“å‰ Hydra ç”Ÿæˆçš„ç›®å½•</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span> <span class=o>=</span> <span class=n>TensorBoardLogger</span><span class=p>(</span><span class=n>save_dir</span><span class=o>=</span><span class=s2>&#34;.&#34;</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=n>version</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 4. å®ä¾‹åŒ– Trainer</span>
</span></span><span class=line><span class=cl>    <span class=n>trainer</span> <span class=o>=</span> <span class=n>pl</span><span class=o>.</span><span class=n>Trainer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>max_epochs</span><span class=o>=</span><span class=n>cfg</span><span class=o>.</span><span class=n>train</span><span class=o>.</span><span class=n>max_epochs</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>accelerator</span><span class=o>=</span><span class=n>cfg</span><span class=o>.</span><span class=n>train</span><span class=o>.</span><span class=n>accelerator</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>devices</span><span class=o>=</span><span class=n>cfg</span><span class=o>.</span><span class=n>train</span><span class=o>.</span><span class=n>devices</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>=</span><span class=n>logger</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>enable_progress_bar</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 5. å¼€å§‹è®­ç»ƒ</span>
</span></span><span class=line><span class=cl>    <span class=n>trainer</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>train_loader</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=å¦‚ä½•è¿è¡Œå®éªŒ>å¦‚ä½•è¿è¡Œå®éªŒ</h2><p>åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä½“éªŒ Hydra çš„å¼ºå¤§åŠŸèƒ½ã€‚</p><h3 id=åŸºç¡€è¿è¡Œ>åŸºç¡€è¿è¡Œ</h3><p>ä½¿ç”¨é»˜è®¤é…ç½®è¿è¡Œï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>python main.py
</span></span></code></pre></td></tr></table></div></div><p><em>æ³¨ï¼šæ—¥å¿—ä¼šè‡ªåŠ¨ä¿å­˜åœ¨ <code>outputs/YYYY-MM-DD/HH-MM-SS/</code> ç›®å½•ä¸‹ã€‚</em></p><h3 id=åŠ¨æ€ä¿®æ”¹å‚æ•°-override>åŠ¨æ€ä¿®æ”¹å‚æ•° (Override)</h3><p>ä¸ä¿®æ”¹ä»£ç ï¼Œç›´æ¥åœ¨å‘½ä»¤è¡Œæ”¹å˜å­¦ä¹ ç‡å’Œ Epochï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python main.py model.learning_rate<span class=o>=</span>0.001 train.max_epochs<span class=o>=</span><span class=m>20</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=å¤šé‡è¿è¡Œ-multirun--grid-search>å¤šé‡è¿è¡Œ (Multirun / Grid Search)</h3><p><strong>è¿™æ˜¯å¯¹æ¯”å®éªŒçš„æ ¸å¿ƒåŠŸèƒ½</strong>ã€‚ä¸€æ¡å‘½ä»¤è¿è¡Œ 4 ç»„å®éªŒï¼ˆ2ç§ hidden_dim * 2ç§ learning_rateï¼‰ï¼š</p><p>Bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python main.py -m model.hidden_dim<span class=o>=</span>64,128 model.learning_rate<span class=o>=</span>0.01,0.001
</span></span></code></pre></td></tr></table></div></div><p><em>æ³¨ï¼šHydra ä¼šåœ¨ <code>multirun/</code> ç›®å½•ä¸‹ä¸ºæ¯ç»„å®éªŒç”Ÿæˆç‹¬ç«‹çš„å­æ–‡ä»¶å¤¹å’Œæ—¥å¿—ã€‚</em></p><h3 id=è¿›é˜¶æŠ€å·§ä½¿ç”¨-instantiate-æ›´ä¼˜é›…çš„å†™æ³•>è¿›é˜¶æŠ€å·§ï¼šä½¿ç”¨ <code>instantiate</code> (æ›´ä¼˜é›…çš„å†™æ³•)</h3><p>ä¸Šé¢çš„ <code>main.py</code> ä¸­ï¼Œæˆ‘ä»¬æ‰‹åŠ¨æŠŠ <code>cfg.model.xxx</code> ä¼ ç»™äº† <code>LitModel</code>ã€‚å¦‚æœä½ å‚æ•°å¾ˆå¤šï¼Œè¿™å¾ˆéº»çƒ¦ã€‚
Hydra æä¾›äº†ä¸€ä¸ªé«˜çº§åŠŸèƒ½ï¼š<strong>Object Instantiation</strong>ã€‚</p><ol><li><p><strong>ä¿®æ”¹ YAML</strong>ï¼ŒåŠ å…¥ <code>_target_</code> æŒ‡å‘ç±»è·¯å¾„ï¼šYAML</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># conf/model/small.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>_target_</span><span class=p>:</span><span class=w> </span><span class=l>src.model.LitModel </span><span class=w> </span><span class=c># &lt;--- å…³é”®</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>input_dim</span><span class=p>:</span><span class=w> </span><span class=m>28</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>hidden_dim</span><span class=p>:</span><span class=w> </span><span class=m>64</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>learning_rate</span><span class=p>:</span><span class=w> </span><span class=m>0.01</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><hr><ol><li><p><strong>ä¿®æ”¹ <code>main.py</code></strong>ï¼Œä½¿ç”¨ <code>hydra.utils.instantiate</code>ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hydra</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@hydra.main</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>(</span><span class=n>cfg</span><span class=p>:</span> <span class=n>DictConfig</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># è¿™è¡Œä»£ç ä¼šè‡ªåŠ¨å¯»æ‰¾ _target_ æŒ‡å‘çš„ç±»ï¼Œ</span>
</span></span><span class=line><span class=cl>    <span class=c1># å¹¶æŠŠ yaml é‡Œå‰©ä¸‹çš„å‚æ•°å…¨éƒ¨ä¼ ç»™è¿™ä¸ªç±»çš„ __init__</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span> <span class=o>=</span> <span class=n>hydra</span><span class=o>.</span><span class=n>utils</span><span class=o>.</span><span class=n>instantiate</span><span class=p>(</span><span class=n>cfg</span><span class=o>.</span><span class=n>model</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>trainer</span> <span class=o>=</span> <span class=n>pl</span><span class=o>.</span><span class=n>Trainer</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>trainer</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=o>...</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=æŸ¥çœ‹ç»“æœ>æŸ¥çœ‹ç»“æœ</h2><p>ä½¿ç”¨ TensorBoard æŸ¥çœ‹æ‰€æœ‰å®éªŒçš„å¯¹æ¯”ï¼š</p><p>Bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># å¦‚æœæ˜¯å•æ¬¡è¿è¡Œ</span>
</span></span><span class=line><span class=cl>tensorboard --logdir outputs
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¦‚æœä½¿ç”¨äº† -m å¤šé‡è¿è¡Œ</span>
</span></span><span class=line><span class=cl>tensorboard --logdir multirun
</span></span></code></pre></td></tr></table></div></div><p>åœ¨ TensorBoard çš„ <strong>HPARAMS</strong> æ ‡ç­¾é¡µä¸­ï¼Œä½ å¯ä»¥ç›´è§‚åœ°çœ‹åˆ° Parallel Coordinates å›¾ï¼Œå±•ç¤º <code>learning_rate</code> å’Œ <code>hidden_dim</code> å¦‚ä½•å½±å“æœ€ç»ˆçš„ Lossã€‚</p><h2 id=ä¿®æ”¹logä½ç½®>ä¿®æ”¹logä½ç½®</h2><p>ä¿®æ”¹ä¿å­˜åœ°å€å’Œæ–‡ä»¶åä¸»è¦æ¶‰åŠåˆ°ä¸¤ä¸ªå±‚é¢ï¼š</p><ol><li><strong>æ–‡ä»¶å¤¹ç»“æ„ï¼ˆHydra æ§åˆ¶ï¼‰</strong>ï¼šå†³å®šäº†æ•´ä¸ªå®éªŒçš„è¾“å‡ºç›®å½•åœ¨å“ªé‡Œï¼ˆä¾‹å¦‚ä»é»˜è®¤çš„ <code>outputs/æ—¥æœŸ/æ—¶é—´</code> æ”¹ä¸º <code>experiments/å®éªŒå/</code>ï¼‰ã€‚</li><li><strong>æ¨¡å‹æ–‡ä»¶åï¼ˆPyTorch Lightning æ§åˆ¶ï¼‰</strong>ï¼šå†³å®šäº† <code>.ckpt</code> æƒé‡æ–‡ä»¶å«ä»€ä¹ˆåå­—ï¼ˆä¾‹å¦‚ä» <code>epoch=0-step=100.ckpt</code> æ”¹ä¸º <code>best-acc=0.98.ckpt</code>ï¼‰ã€‚</li></ol><p>ä»¥ä¸‹æ˜¯å…·ä½“çš„ä¿®æ”¹æ–¹æ³•ï¼š</p><hr><h3 id=1-ä¿®æ”¹è¾“å‡ºæ–‡ä»¶å¤¹è·¯å¾„-hydra-é…ç½®>1. ä¿®æ”¹è¾“å‡ºæ–‡ä»¶å¤¹è·¯å¾„ (Hydra é…ç½®)</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒHydra ä¼šåœ¨ <code>outputs/${now:%Y-%m-%d}/${now:%H-%M-%S}</code> åˆ›å»ºç›®å½•ã€‚è¦è‡ªå®šä¹‰å®ƒï¼Œä½ éœ€è¦åœ¨ <strong><code>conf/config.yaml</code></strong> ä¸­æ·»åŠ  <code>hydra</code> é…ç½®èŠ‚ç‚¹ã€‚</p><p><strong>ä¿®æ”¹ <code>conf/config.yaml</code>ï¼š</strong></p><p>YAML</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>defaults</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>model</span><span class=p>:</span><span class=w> </span><span class=l>default_model</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>train</span><span class=p>:</span><span class=w> </span><span class=l>default_train</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>_self_</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># å®šä¹‰ä¸€ä¸ªé¡¹ç›®åæˆ–å®éªŒå</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>experiment_name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;my_custom_experiment&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># --- Hydra é…ç½®æ ¸å¿ƒ ---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>hydra</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>run</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># ä¿®æ”¹å•æ¬¡è¿è¡Œçš„è¾“å‡ºè·¯å¾„</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># ç¤ºä¾‹ï¼š./logs/my_custom_experiment/2023-10-27_10-30/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>dir</span><span class=p>:</span><span class=w> </span><span class=l>./logs/${experiment_name}/${now:%Y-%m-%d_%H-%M-%S}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>sweep</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># ä¿®æ”¹å¤šé‡è¿è¡Œ (-m) çš„æ ¹ç›®å½•å’Œå­ç›®å½•</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>dir</span><span class=p>:</span><span class=w> </span><span class=l>./multirun_logs/${experiment_name}/${now:%Y-%m-%d_%H-%M-%S}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>subdir</span><span class=p>:</span><span class=w> </span><span class=l>${hydra.job.num}</span><span class=w> </span><span class=c># å­æ–‡ä»¶å¤¹åä¸º 0, 1, 2...</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>è¿™æ ·è®¾ç½®åï¼Œä½ çš„å®éªŒæ–‡ä»¶å°±ä¸ä¼šæ•£è½åœ¨ <code>outputs</code> é‡Œï¼Œè€Œæ˜¯æ•´é½åœ°å­˜æ”¾åœ¨ <code>logs/</code> ä¸‹ã€‚</p><hr><h3 id=2-ä¿®æ”¹æ—¥å¿—æ–‡ä»¶å¤¹åç§°-logger-é…ç½®>2. ä¿®æ”¹æ—¥å¿—æ–‡ä»¶å¤¹åç§° (Logger é…ç½®)</h3><p>åœ¨ <code>main.py</code> ä¸­åˆå§‹åŒ– <code>TensorBoardLogger</code> æ—¶ï¼Œå¦‚æœä½ çš„ Hydra è·¯å¾„å·²ç»å¾ˆç²¾ç¡®äº†ï¼ˆæ¯”å¦‚ä¸Šé¢å·²ç»ç²¾ç¡®åˆ°äº†ç§’ï¼‰ï¼Œé€šå¸¸æˆ‘ä»¬å¸Œæœ› Logger <strong>ä¸è¦å†åˆ›å»ºå­æ–‡ä»¶å¤¹</strong>ï¼ˆä¸è¦å†æä¸ª <code>version_0</code>ï¼‰ï¼Œè€Œæ˜¯ç›´æ¥å†™åœ¨å½“å‰ç›®å½•ã€‚</p><p><strong>ä¿®æ”¹ <code>main.py</code>ï¼š</strong></p><p>Python</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># &#34;.&#34; è¡¨ç¤ºç›´æ¥ä½¿ç”¨ Hydra åˆ›å»ºå¥½çš„é‚£ä¸ªç›®å½•ï¼Œä¸åˆ›å»ºæ–°çš„å­æ–‡ä»¶å¤¹</span>
</span></span><span class=line><span class=cl><span class=c1># name=&#34;&#34; å’Œ version=&#34;&#34; èƒ½å¤Ÿå»é™¤é¢å¤–çš„ç›®å½•å±‚çº§</span>
</span></span><span class=line><span class=cl><span class=n>logger</span> <span class=o>=</span> <span class=n>TensorBoardLogger</span><span class=p>(</span><span class=n>save_dir</span><span class=o>=</span><span class=s2>&#34;.&#34;</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=n>version</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=3-ä¿®æ”¹æ¨¡å‹æƒé‡æ–‡ä»¶å-checkpoint-å›è°ƒ>3. ä¿®æ”¹æ¨¡å‹æƒé‡æ–‡ä»¶å (Checkpoint å›è°ƒ)</h3><p>è¿™æ˜¯æœ€é‡è¦çš„ä¸€æ­¥ã€‚ä½ éœ€è¦ä½¿ç”¨ PyTorch Lightning çš„ <code>ModelCheckpoint</code> å›è°ƒæ¥è‡ªå®šä¹‰ä¿å­˜çš„æ–‡ä»¶åï¼ˆä¾‹å¦‚åŒ…å«éªŒè¯é›†å‡†ç¡®ç‡ï¼‰ã€‚</p><p><strong>ä¿®æ”¹ <code>main.py</code>ï¼š</strong></p><p>Python</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pytorch_lightning.callbacks</span> <span class=kn>import</span> <span class=n>ModelCheckpoint</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ... åœ¨ main å‡½æ•°ä¸­ ...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>(</span><span class=n>cfg</span><span class=p>:</span> <span class=n>DictConfig</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># ... æ¨¡å‹åˆå§‹åŒ–ä»£ç  ...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># --- å®šä¹‰ Checkpoint å›è°ƒ ---</span>
</span></span><span class=line><span class=cl>    <span class=n>checkpoint_callback</span> <span class=o>=</span> <span class=n>ModelCheckpoint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>dirpath</span><span class=o>=</span><span class=s2>&#34;.&#34;</span><span class=p>,</span>                  <span class=c1># ä¿å­˜è·¯å¾„ï¼šç›´æ¥å­˜åœ¨å½“å‰ Hydra ç›®å½•ä¸‹</span>
</span></span><span class=line><span class=cl>        <span class=n>filename</span><span class=o>=</span><span class=s2>&#34;best-</span><span class=si>{epoch:02d}</span><span class=s2>-</span><span class=si>{val_loss:.2f}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=c1># æ–‡ä»¶åæ ¼å¼</span>
</span></span><span class=line><span class=cl>        <span class=n>monitor</span><span class=o>=</span><span class=s2>&#34;val_loss&#34;</span><span class=p>,</span>           <span class=c1># ç›‘æ§çš„æŒ‡æ ‡ (éœ€åœ¨ training_step ç”¨ self.log è®°å½•è¿‡)</span>
</span></span><span class=line><span class=cl>        <span class=n>mode</span><span class=o>=</span><span class=s2>&#34;min&#34;</span><span class=p>,</span>                   <span class=c1># &#34;min&#34; è¡¨ç¤º loss è¶Šå°è¶Šå¥½</span>
</span></span><span class=line><span class=cl>        <span class=n>save_top_k</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>                 <span class=c1># åªä¿å­˜æœ€å¥½çš„ 1 ä¸ªæ¨¡å‹</span>
</span></span><span class=line><span class=cl>        <span class=n>save_last</span><span class=o>=</span><span class=kc>True</span>                <span class=c1># é¢å¤–ä¿å­˜ä¸€ä¸ª last.ckpt (æœ€æ–°çš„æ¨¡å‹ï¼Œä»¥é˜²ä¸­æ–­)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>trainer</span> <span class=o>=</span> <span class=n>pl</span><span class=o>.</span><span class=n>Trainer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=c1># ... å…¶ä»–å‚æ•° ...</span>
</span></span><span class=line><span class=cl>        <span class=n>callbacks</span><span class=o>=</span><span class=p>[</span><span class=n>checkpoint_callback</span><span class=p>],</span> <span class=c1># æ³¨å†Œå›è°ƒ</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>=</span><span class=n>logger</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>trainer</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>train_loader</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>æ³¨æ„ï¼šä½ åœ¨ filename é‡Œä½¿ç”¨çš„ {val_loss} å¿…é¡»åœ¨ä½ çš„ LitModel ä»£ç é‡Œé€šè¿‡ self.log(&ldquo;val_loss&rdquo;, &mldr;) è®°å½•è¿‡ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p></blockquote><hr><h3 id=4-å®Œæ•´æ•´åˆç¤ºä¾‹>4. å®Œæ•´æ•´åˆç¤ºä¾‹</h3><p>æŠŠä½ ç°åœ¨çš„ <code>conf/config.yaml</code> å’Œ <code>main.py</code> æ›´æ–°ä¸ºä»¥ä¸‹å†…å®¹ï¼š</p><h3 id=confconfigyaml-1><code>conf/config.yaml</code></h3><p>YAML</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>defaults</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>model</span><span class=p>:</span><span class=w> </span><span class=l>default_model</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>train</span><span class=p>:</span><span class=w> </span><span class=l>default_train</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>_self_</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>experiment_name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;resnet_cifar10&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>hydra</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>run</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># æœ€ç»ˆè·¯å¾„: logs/resnet_cifar10/2023-xx-xx_12-00-00/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>dir</span><span class=p>:</span><span class=w> </span><span class=l>logs/${experiment_name}/${now:%Y-%m-%d_%H-%M-%S}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>sweep</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>dir</span><span class=p>:</span><span class=w> </span><span class=l>multirun/${experiment_name}/${now:%Y-%m-%d_%H-%M-%S}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>subdir</span><span class=p>:</span><span class=w> </span><span class=l>run_${hydra.job.num}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=mainpy-1><code>main.py</code></h3><p>Python</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hydra</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>omegaconf</span> <span class=kn>import</span> <span class=n>DictConfig</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pytorch_lightning</span> <span class=k>as</span> <span class=nn>pl</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pytorch_lightning.loggers</span> <span class=kn>import</span> <span class=n>TensorBoardLogger</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pytorch_lightning.callbacks</span> <span class=kn>import</span> <span class=n>ModelCheckpoint</span>
</span></span><span class=line><span class=cl><span class=c1># ... import your model ...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@hydra.main</span><span class=p>(</span><span class=n>version_base</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>config_path</span><span class=o>=</span><span class=s2>&#34;conf&#34;</span><span class=p>,</span> <span class=n>config_name</span><span class=o>=</span><span class=s2>&#34;config&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>(</span><span class=n>cfg</span><span class=p>:</span> <span class=n>DictConfig</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>pl</span><span class=o>.</span><span class=n>seed_everything</span><span class=p>(</span><span class=mi>42</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>model</span> <span class=o>=</span> <span class=o>...</span> <span class=c1># åˆå§‹åŒ–ä½ çš„æ¨¡å‹</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 1. è®¾ç½®æ—¥å¿—å™¨ï¼šç›´æ¥å†™åœ¨ Hydra ç›®å½•ä¸‹</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span> <span class=o>=</span> <span class=n>TensorBoardLogger</span><span class=p>(</span><span class=n>save_dir</span><span class=o>=</span><span class=s2>&#34;.&#34;</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=n>version</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 2. è®¾ç½®æ¨¡å‹ä¿å­˜è§„åˆ™</span>
</span></span><span class=line><span class=cl>    <span class=c1># å‡è®¾æ¨¡å‹é‡Œ log äº† &#39;val_acc&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>checkpoint_callback</span> <span class=o>=</span> <span class=n>ModelCheckpoint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>dirpath</span><span class=o>=</span><span class=s2>&#34;checkpoints&#34;</span><span class=p>,</span>  <span class=c1># ä¼šåœ¨ Hydra ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª checkpoints æ–‡ä»¶å¤¹</span>
</span></span><span class=line><span class=cl>        <span class=n>filename</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>{epoch:02d}</span><span class=s2>-</span><span class=si>{val_acc:.4f}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=c1># æ¯”å¦‚: 05-0.9821.ckpt</span>
</span></span><span class=line><span class=cl>        <span class=n>monitor</span><span class=o>=</span><span class=s2>&#34;val_acc&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>mode</span><span class=o>=</span><span class=s2>&#34;max&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>save_top_k</span><span class=o>=</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>trainer</span> <span class=o>=</span> <span class=n>pl</span><span class=o>.</span><span class=n>Trainer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>max_epochs</span><span class=o>=</span><span class=n>cfg</span><span class=o>.</span><span class=n>train</span><span class=o>.</span><span class=n>max_epochs</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>=</span><span class=n>logger</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>callbacks</span><span class=o>=</span><span class=p>[</span><span class=n>checkpoint_callback</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=c1># ...</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>trainer</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=æœ€ç»ˆæ•ˆæœ>æœ€ç»ˆæ•ˆæœ</h3><p>è¿è¡Œåï¼Œä½ çš„æ–‡ä»¶ç»“æ„ä¼šéå¸¸æ¸…æ™°ï¼š</p><p>Plaintext</p><p>logs/
â””â”€â”€ resnet_cifar10/ &lt;&ndash; config.yaml ä¸­çš„ experiment_name
â””â”€â”€ 2023-11-20_10-30-00/ &lt;&ndash; æ—¶é—´æˆ³
â”œâ”€â”€ .hydra/ &lt;&ndash; Hydra çš„é…ç½®å¤‡ä»½
â”œâ”€â”€ checkpoints/ &lt;&ndash; ModelCheckpoint åˆ›å»ºçš„æ–‡ä»¶å¤¹
â”‚ â””â”€â”€ 05-0.9821.ckpt &lt;&ndash; è‡ªå®šä¹‰çš„æ–‡ä»¶å
â”œâ”€â”€ events.out.tfevents&mldr; &lt;&ndash; TensorBoard æ—¥å¿—
â””â”€â”€ hparams.yaml &lt;&ndash; PL è‡ªåŠ¨ä¿å­˜çš„å‚æ•°</p></section><footer class=article-footer><section class=article-tags><a href=/research_blog/tags/pytorch/>Pytorch</a>
<a href=/research_blog/tags/hydra/>Hydra</a>
<a href=/research_blog/tags/lightning/>Lightning</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=[".main-article",".widget--toc"];e.forEach(e=>{const t=document.querySelector(e);t&&renderMathInElement(t,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/research_blog/p/julia-fmcw-radar-simulation/><div class=article-details><h2 class=article-title>åŸºäº Julia çš„ FMCW é›·è¾¾å·¥ä½œåŸç†ä»¿çœŸ</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2025 Fei's Research Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.32.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/research_blog/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>